drop table if exists fact;
CREATE TABLE Fact(
	FactPK int NOT NULL,
	Source varchar(255) NULL,
	Indicator varchar(256) NULL,
	PNAICS varchar(7) NULL,
	PNAICS_description varchar(255) NULL,
	GeoName varchar(255) NULL,
	Year varchar(10) NULL,
	Value float NULL);

drop table if exists dimGeography;	
CREATE TABLE dimGeography(
	geoName_PK varchar(255) NOT NULL,
	Standardised_Province varchar(255) NULL
);

drop table if exists dimIndustry;
CREATE TABLE dimIndustry(
	PNAICS varchar(7) NOT NULL,
	NAICS6 varchar(7) NULL,
	NAICS5 varchar(7) NULL,
	NAICS4 varchar(7) NULL,
	NAICS3 varchar(7) NULL,
	NAICS2 varchar(7) NULL,
	Creative_Sector varchar(255) NULL
);

DROP TABLE IF EXISTS Census;
CREATE TABLE Census(
	geoName varchar(255) NULL,
	ANAICS4 varchar(5) NULL,
	ANOCS4 varchar(5) NULL,
	Occupation_Description varchar(255) NULL,
	Industry_Description varchar(255) NULL,
	Value float NULL
);

DROP TABLE IF EXISTS dimOccupations;
CREATE TABLE dimOccupations(
	ANOCS4 varchar(5) NULL,
	oNESTA varchar(5) NULL,
	oHiggs varchar(5) NULL,
	oFreeman varchar(8) NULL,
	Occupation_Description varchar(255) NULL,
	Creative_Occupation_Type varchar(12) NULL
);


drop table if exists industryDescriptions;
CREATE TABLE industryDescriptions(
	NAICS6 varchar(6) NULL,
	Description varchar(255) NULL
);

DROP VIEW if exists Creative_Industries;
CREATE VIEW Creative_Industries AS

SELECT        
Industries.Value, 
Industries.Year, 
Industries.Indicator, 
Industries.Standardised_Province, 
Industries.Source, 
Industries.Creative_Sector, 
Industries.NAICS4, 
industryDescriptions.Description

FROM            

(SELECT        
SUM(Fact.Value) AS Value, 
Fact.Year, 
Fact.Indicator, 
dimGeography.Standardised_Province, 
Fact.Source, 
dimIndustry.Creative_Sector, 
Fact.PNAICS, 
dimIndustry.PNAICS AS NIPNAICS, 
dimIndustry.NAICS6, 
dimIndustry.NAICS5, 
dimIndustry.NAICS4, 
dimIndustry.NAICS3, 
dimIndustry.NAICS2

FROM dimGeography 
RIGHT OUTER JOIN Fact ON dimGeography.geoName_PK = Fact.GeoName 
RIGHT OUTER JOIN dimIndustry ON Fact.PNAICS = dimIndustry.PNAICS

GROUP BY 
dimIndustry.Creative_Sector, 
Fact.Source, 
dimGeography.Standardised_Province, 
Fact.Indicator, 
Fact.GeoName, 
Fact.Year, 
Fact.PNAICS, 
dimIndustry.PNAICS, 
dimIndustry.NAICS6, 
dimIndustry.NAICS5, 
dimIndustry.NAICS4, 
dimIndustry.NAICS3, 
dimIndustry.NAICS2, 
Fact.Value) AS Industries 

LEFT OUTER JOIN industryDescriptions ON Industries.NAICS4 = industryDescriptions.NAICS6;

DROP VIEW IF EXISTS Industries;
CREATE VIEW Industries AS

SELECT        
SUM(Fact.Value) AS Value, 
Fact.Year, 
Fact.Indicator, 
dimGeography.Standardised_Province, 
Fact.Source, 
dimIndustry.Creative_Sector, 
Fact.PNAICS, 
dimIndustry.PNAICS AS NIPNAICS,
dimIndustry.NAICS6, 
dimIndustry.NAICS5, 
dimIndustry.NAICS4, 
dimIndustry.NAICS3, 
dimIndustry.NAICS2

FROM            

dimGeography 
RIGHT OUTER JOIN Fact ON dimGeography.geoName_PK = Fact.GeoName 
RIGHT OUTER JOIN dimIndustry ON Fact.PNAICS = dimIndustry.PNAICS

GROUP BY 

dimIndustry.Creative_Sector, 
Fact.Source, 
dimGeography.Standardised_Province, 
Fact.Indicator, 
Fact.GeoName, 
Fact.Year, 
Fact.PNAICS, 
dimIndustry.PNAICS, 
dimIndustry.NAICS6, 
dimIndustry.NAICS5, 
dimIndustry.NAICS4, 
dimIndustry.NAICS3, 
dimIndustry.NAICS2, 
Fact.Value;

